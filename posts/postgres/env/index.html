<!doctype html><html lang=en>
<head>
<title>
Postgres源码编译及调试 ::
Hello Friend — A simple theme for Hugo
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="源码编译 #   源码下载 直接下载最新源码，github上的源码每一个提交都保证是可编译运行的  git clone git@github.com:postgres/postgres.git  依赖安装
按照官网上的说明安装依赖，这里提前安装过但是没有记载，所以不贴了，也可以直接编译，在中间遇到确实的依赖再进行安装
  编译
  为了能使用gdb调试，需要使用debug模式调试，我自己之前编译的时候发现即使指定-enable-debug在编译的时候发现也使用了-O2，所以这里建议直接修改configure中的-O和-O2为-g,
./configure --enable-depend --enable-cassert --enable-debug make sudo make install 启动  ./initdb -D /home/wen/postgres/data ./pg_ctl -D /home/wen/postgres/data start ./pg_ctl -D /home/wen/postgres/data stop ./psql -p 5432 直接安装之后的文件在/usr/local/pgsql/bin中
使用VSCode调试  可以使用VSCode进行调试，只需要配置launch.json即可。文件如下，其中program不重要，具体想调试那个进程，是使用processId选定的，调试的时候会有一个窗口让你选择调试进程。
{ // 使用 IntelliSense 了解相关属性。  // 悬停以查看现有属性的描述。  // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387  &amp;#34;version&amp;#34;: &amp;#34;0.2.0&amp;#34;, &amp;#34;configurations&amp;#34;: [ { &amp;#34;name&amp;#34;: &amp;#34;(gdb) 附加&amp;#34;, &amp;#34;type&amp;#34;: &amp;#34;cppdbg&amp;#34;, &amp;#34;request&amp;#34;: &amp;#34;attach&amp;#34;, &amp;#34;program&amp;#34;: &amp;#34;/usr/local/pgsql/bin/postgres&amp;#34;, &amp;#34;processId&amp;#34;: &amp;#34;${command:pickProcess}&amp;#34;, &amp;#34;MIMode&amp;#34;: &amp;#34;gdb&amp;#34;, &amp;#34;setupCommands&amp;#34;: [ { &amp;#34;description&amp;#34;: &amp;#34;为 gdb 启用整齐打印&amp;#34;, &amp;#34;text&amp;#34;: &amp;#34;-enable-pretty-printing&amp;#34;, &amp;#34;ignoreFailures&amp;#34;: true }, { &amp;#34;description&amp;#34;: &amp;#34;将反汇编风格设置为 Intel&amp;#34;, &amp;#34;text&amp;#34;: &amp;#34;-gdb-set disassembly-flavor intel&amp;#34;, &amp;#34;ignoreFailures&amp;#34;: true } ] } ] } 这里有几个进程需要进行区分，由于pg是典型的CS架构，">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=https://Esoye.github.io/posts/postgres/env/>
<link rel=stylesheet href=https://Esoye.github.io/assets/style.css>
<link rel=stylesheet href=https://Esoye.github.io/style.css>
<link rel=apple-touch-icon-precomposed sizes=144x144 href=https://Esoye.github.io/img/apple-touch-icon-144-precomposed.png>
<link rel="shortcut icon" href=https://Esoye.github.io/img/favicon.png>
<link href=https://Esoye.github.io/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin>
<link href=https://Esoye.github.io/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Postgres源码编译及调试">
<meta name=twitter:description content="源码编译 #   源码下载 直接下载最新源码，github上的源码每一个提交都保证是可编译运行的  git clone git@github.com:postgres/postgres.git  依赖安装
按照官网上的说明安装依赖，这里提前安装过但是没有记载，所以不贴了，也可以直接编译，在中间遇到确实的依赖再进行安装
  编译
  为了能使用gdb调试，需要使用debug模式调试，我自己之前编译的时候发现即使指定-enable-debug在编译的时候发现也使用了-O2，所以这里建议直接修改configure中的-O和-O2为-g,
./configure --enable-depend --enable-cassert --enable-debug make sudo make install 启动  ./initdb -D /home/wen/postgres/data ./pg_ctl -D /home/wen/postgres/data start ./pg_ctl -D /home/wen/postgres/data stop ./psql -p 5432 直接安装之后的文件在/usr/local/pgsql/bin中
使用VSCode调试  可以使用VSCode进行调试，只需要配置launch.json即可。文件如下，其中program不重要，具体想调试那个进程，是使用processId选定的，调试的时候会有一个窗口让你选择调试进程。
{ // 使用 IntelliSense 了解相关属性。  // 悬停以查看现有属性的描述。  // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387  &#34;version&#34;: &#34;0.2.0&#34;, &#34;configurations&#34;: [ { &#34;name&#34;: &#34;(gdb) 附加&#34;, &#34;type&#34;: &#34;cppdbg&#34;, &#34;request&#34;: &#34;attach&#34;, &#34;program&#34;: &#34;/usr/local/pgsql/bin/postgres&#34;, &#34;processId&#34;: &#34;${command:pickProcess}&#34;, &#34;MIMode&#34;: &#34;gdb&#34;, &#34;setupCommands&#34;: [ { &#34;description&#34;: &#34;为 gdb 启用整齐打印&#34;, &#34;text&#34;: &#34;-enable-pretty-printing&#34;, &#34;ignoreFailures&#34;: true }, { &#34;description&#34;: &#34;将反汇编风格设置为 Intel&#34;, &#34;text&#34;: &#34;-gdb-set disassembly-flavor intel&#34;, &#34;ignoreFailures&#34;: true } ] } ] } 这里有几个进程需要进行区分，由于pg是典型的CS架构，">
<meta property="og:title" content="Postgres源码编译及调试">
<meta property="og:description" content="源码编译 #   源码下载 直接下载最新源码，github上的源码每一个提交都保证是可编译运行的  git clone git@github.com:postgres/postgres.git  依赖安装
按照官网上的说明安装依赖，这里提前安装过但是没有记载，所以不贴了，也可以直接编译，在中间遇到确实的依赖再进行安装
  编译
  为了能使用gdb调试，需要使用debug模式调试，我自己之前编译的时候发现即使指定-enable-debug在编译的时候发现也使用了-O2，所以这里建议直接修改configure中的-O和-O2为-g,
./configure --enable-depend --enable-cassert --enable-debug make sudo make install 启动  ./initdb -D /home/wen/postgres/data ./pg_ctl -D /home/wen/postgres/data start ./pg_ctl -D /home/wen/postgres/data stop ./psql -p 5432 直接安装之后的文件在/usr/local/pgsql/bin中
使用VSCode调试  可以使用VSCode进行调试，只需要配置launch.json即可。文件如下，其中program不重要，具体想调试那个进程，是使用processId选定的，调试的时候会有一个窗口让你选择调试进程。
{ // 使用 IntelliSense 了解相关属性。  // 悬停以查看现有属性的描述。  // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387  &#34;version&#34;: &#34;0.2.0&#34;, &#34;configurations&#34;: [ { &#34;name&#34;: &#34;(gdb) 附加&#34;, &#34;type&#34;: &#34;cppdbg&#34;, &#34;request&#34;: &#34;attach&#34;, &#34;program&#34;: &#34;/usr/local/pgsql/bin/postgres&#34;, &#34;processId&#34;: &#34;${command:pickProcess}&#34;, &#34;MIMode&#34;: &#34;gdb&#34;, &#34;setupCommands&#34;: [ { &#34;description&#34;: &#34;为 gdb 启用整齐打印&#34;, &#34;text&#34;: &#34;-enable-pretty-printing&#34;, &#34;ignoreFailures&#34;: true }, { &#34;description&#34;: &#34;将反汇编风格设置为 Intel&#34;, &#34;text&#34;: &#34;-gdb-set disassembly-flavor intel&#34;, &#34;ignoreFailures&#34;: true } ] } ] } 这里有几个进程需要进行区分，由于pg是典型的CS架构，">
<meta property="og:type" content="article">
<meta property="og:url" content="https://Esoye.github.io/posts/postgres/env/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-07-20T17:54:05+08:00">
<meta property="article:modified_time" content="2022-07-20T17:54:05+08:00"><meta property="og:site_name" content="Hello Friend">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>hello friend</span>
<span class=logo__cursor></span>
</a>
<span class=header__right>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li>
<li><a href=/archive>Archive</a></li>
<li><a href=/showcase>Showcase</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li>
<li><a href=/archive>Archive</a></li>
<li><a href=/showcase>Showcase</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>Postgres源码编译及调试</h1>
<div class=post-meta>
<span class=post-date>
2022-07-20
</span>
</div>
<div class=post-content>
<h2 id=源码编译>
源码编译
<a href=#%e6%ba%90%e7%a0%81%e7%bc%96%e8%af%91 class=h-anchor aria-hidden=true>#</a>
</h2>
<ol>
<li>源码下载
直接下载最新源码，github上的源码每一个提交都保证是可编译运行的</li>
</ol>
<pre tabindex=0><code>git clone git@github.com:postgres/postgres.git
</code></pre><ol start=2>
<li>
<p>依赖安装<br>
按照官网上的说明安装依赖，这里提前安装过但是没有记载，所以不贴了，也可以直接编译，在中间遇到确实的依赖再进行安装</p>
</li>
<li>
<p>编译</p>
</li>
</ol>
<p>为了能使用gdb调试，需要使用debug模式调试，我自己之前编译的时候发现即使指定<code>-enable-debug</code>在编译的时候发现也使用了<code>-O2</code>，所以这里建议直接修改<code>configure</code>中的<code>-O</code>和<code>-O2</code>为<code>-g</code>,</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./configure --enable-depend --enable-cassert --enable-debug

make

sudo make install
</code></pre></div><ol start=4>
<li>启动</li>
</ol>
<pre tabindex=0><code>./initdb -D /home/wen/postgres/data 
./pg_ctl -D /home/wen/postgres/data  start
./pg_ctl -D /home/wen/postgres/data  stop
./psql -p 5432
</code></pre><p>直接安装之后的文件在<code>/usr/local/pgsql/bin</code>中</p>
<ol start=5>
<li>使用VSCode调试</li>
</ol>
<p>可以使用VSCode进行调试，只需要配置<code>launch.json</code>即可。文件如下，其中program不重要，具体想调试那个进程，是使用processId选定的，调试的时候会有一个窗口让你选择调试进程。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#75715e>// 使用 IntelliSense 了解相关属性。 
</span><span style=color:#75715e></span>  <span style=color:#75715e>// 悬停以查看现有属性的描述。
</span><span style=color:#75715e></span>  <span style=color:#75715e>// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387
</span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;0.2.0&#34;</span>,
  <span style=color:#f92672>&#34;configurations&#34;</span>: [
    {
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;(gdb) 附加&#34;</span>,
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;cppdbg&#34;</span>,
      <span style=color:#f92672>&#34;request&#34;</span>: <span style=color:#e6db74>&#34;attach&#34;</span>,
      <span style=color:#f92672>&#34;program&#34;</span>: <span style=color:#e6db74>&#34;/usr/local/pgsql/bin/postgres&#34;</span>,
      <span style=color:#f92672>&#34;processId&#34;</span>: <span style=color:#e6db74>&#34;${command:pickProcess}&#34;</span>,
      <span style=color:#f92672>&#34;MIMode&#34;</span>: <span style=color:#e6db74>&#34;gdb&#34;</span>,
      <span style=color:#f92672>&#34;setupCommands&#34;</span>: [
          {
              <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;为 gdb 启用整齐打印&#34;</span>,
              <span style=color:#f92672>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;-enable-pretty-printing&#34;</span>,
              <span style=color:#f92672>&#34;ignoreFailures&#34;</span>: <span style=color:#66d9ef>true</span>
          },
          {
              <span style=color:#f92672>&#34;description&#34;</span>:  <span style=color:#e6db74>&#34;将反汇编风格设置为 Intel&#34;</span>,
              <span style=color:#f92672>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;-gdb-set disassembly-flavor intel&#34;</span>,
              <span style=color:#f92672>&#34;ignoreFailures&#34;</span>: <span style=color:#66d9ef>true</span>
          }
      ]
    }
  ]
}
</code></pre></div><p>这里有几个进程需要进行区分，由于pg是典型的CS架构，</p>
<ul>
<li>你可以调试psql进程，也就是你命令行执行的进程，</li>
<li>也可以调试守护进程，他接收到新的链接之后会fork一个新进程，</li>
<li>也可以调试他fork出来的进程，这才是你命令行对应的执行进程，语句的解析执行都是在这个进程中</li>
<li>也可以调试其他的进程，，例如vocumm进程，，walwrite进程等</li>
</ul>
<h2 id=gdb-调试>
gdb 调试
<a href=#gdb-%e8%b0%83%e8%af%95 class=h-anchor aria-hidden=true>#</a>
</h2>
<ol>
<li>使用脚本可以在gdb中打印出具体的执行计划的节点树</li>
</ol>
<blockquote>
<p>clang-format 禁止头文件重排序 SortIncludes: false</p>
</blockquote>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://Esoye.github.io/posts/postgres/storage/>
<span class=button__icon>←</span>
<span class=button__text>Postgres Storage</span>
</a>
</span>
<span class="button next">
<a href=https://Esoye.github.io/posts/static/note/>
<span class=button__text>数据库文章资源汇总</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<a href=/ class=logo style=text-decoration:none>
<span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span>
<span class=logo__text>hello friend</span>
<span class=logo__cursor></span>
</a>
<div class=copyright>
<span>© 2022 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span>
</div>
</div>
</footer>
<script src=https://Esoye.github.io/assets/main.js></script>
<script src=https://Esoye.github.io/assets/prism.js></script>
</div>
</body>
</html>